# PROJECT_BRIEF.md — ASBUH Portal (Этап 1 / MVP)

## 0) TL;DR
Создаём единый web-портал для **админа / руководителей / бухгалтеров / клиентов** с ролевыми доступами, “участками” (зона ответственности), карточками организаций и блоком документов. Плюс раздел “Полезная информация” (контакты/материалы/внутренние документы).  
Фокус MVP: **безопасный доступ + правильная модель данных + удобная структура**. Без “автопилота сроков” и интеграций — это дальше.

---

## 1) Контекст и проблема
- Информация по организациям и документы должны быть в одном месте, но доступ строго ограничен.
- Данные чувствительные (в т.ч. банковские логины/пароли) → требуется безопасность и аудит.
- У бухгалтеров есть “участки” (1–100 организаций), руководители контролируют несколько участков.

---

## 2) Цели (Goals)
1. Единая точка входа для всех ролей.
2. Жёсткая разграниченная видимость и права (RBAC) + простое администрирование прав.
3. Карточка организации, расширяемая без боли (добавление новых типов данных).
4. Документы организации: хранение, доступ клиенту и закреплённым сотрудникам.
5. База полезной информации для сотрудников и отдельно — для клиентов.

### Метрики успеха (Success Metrics)
- 100% организаций имеют карточку в портале.
- Время поиска ключевого документа ≤ 30 секунд.
- 0 инцидентов “клиент увидел чужое” (tenant isolation).
- Админ меняет права/доступы ≤ 2 минут (без разработчика).

---

## 3) Объём MVP (Scope)
### Входит в Этап 1 (MVP)
- Аутентификация (логин/пароль), управление пользователями, роли и права (RBAC).
- Саморегистрация клиентов + привязка к организации(ям) с проверкой.
- Сущности: Участок → Организации → Карточка организации → Документы.
- Раздел “Полезная информация”:
  - Рабочие контакты (для руководителей/бухгалтеров)
  - Материалы/статьи/видео (для руководителей/бухгалтеров и отдельно для клиентов)
  - Документация организации (внутренние документы, только staff)
- Аудит-лог ключевых действий.
- Базовая защита: политики паролей, rate limiting, сессии/токены, журналирование.

### Не входит в MVP (Non-goals)
- 2FA как обязательная функция (но закладываем возможность).
- Автогенерация сроков/задач/календарь, контроль дедлайнов, отчётность — это Этап 2+.
- Интеграции с Контур/СБИС/Астрал/банками/ФНС.
- OCR/распознавание документов.
- “Идеальный дизайн” (UI можно заменить вашим, главное — рабочие компоненты).

---

## 4) Роли и доступы (RBAC)
### Роли
- **Администратор**: полный доступ, управление пользователями/ролями/правами/участками/организациями, доступ к системным настройкам.
- **Руководитель**: аудит/контроль; доступ к нескольким участкам; чтение/комментарии/утверждения (детализируем ниже).
- **Бухгалтер**: работа в рамках своих участков/организаций; редактирование карточек и документов (в пределах прав).
- **Клиент**: доступ только к своей организации(ям): просмотр карточки (ограниченный) + документы + загрузка документов.

### Базовые принципы
- По умолчанию: **запрещено всё, кроме разрешённого**.
- Права задаются на уровне: *сущность* (организация/документ/контакт/материал) × *действие* (view/create/edit/delete).
- Вся модель — **multi-tenant**: клиент никогда не может получить доступ к другой организации.

---

## 5) Саморегистрация клиентов (предложение процесса)
Цель: клиенты регистрируются сами, но не могут “приписать себе” чужую организацию.

**Вариант A (рекомендован): инвайт-код**
1) Админ/бухгалтер в карточке организации нажимает “Пригласить клиента”.
2) Система генерирует одноразовый токен-приглашение (срок 24–72 часа) и отправляет ссылку на email/Telegram.
3) Клиент регистрируется → автоматически привязывается к конкретной организации с ролью “Клиент”.

**Вариант B: заявка на доступ**
1) Клиент регистрируется и вводит ИНН/название.
2) Система создаёт заявку на привязку.
3) Админ подтверждает/отклоняет.

MVP: реализуем A, B можно добавить позже (или оставить как fallback).

---

## 6) Функциональные требования

### 6.1 Учётные записи и доступ
- Логин/пароль, восстановление доступа (email).
- Админ создаёт сотрудников и руководителей.
- Клиенты — через саморегистрацию (см. выше).
- Сессии: JWT или серверные сессии (решение на архитектуре).

### 6.2 Участки
- Участок: номер, название (опционально), список организаций, список участников (бухгалтеры), список руководителей (аудиторы).
- Ограничение: от 1 до 100 организаций (логическое, не тех. лимит).

### 6.3 Организации и карточка организации
Организация содержит блоки данных:
- **Общая**
  - Форма (НКО/ИП/ООО)
  - Система Н/О (множественный выбор: УСН 15/6, АУСН 8/20, ПСН, ОСНО, УСН+НДС 5/7/22 и т.д.)
  - Кол-во сотрудников
  - Кол-во операций/мес
  - Наличие кассы (Да/Нет)
  - Ответственные (один/несколько сотрудников)
  - Аудитор(ы)
  - Номер участка
  - Статус (Активный/Новый/…)
- **Юридическая**
  - ИНН (дальше: КПП, юр. адрес и т.д. — как расширение)
- **Банковская**
  - Кол-во расчётных счетов
  - Для каждого банка: банк, логин, пароль, комментарий (куда СМС)
- **Бухгалтерская**
  - ЭЦП (нет/у клиента/у нас)
  - Срок окончания ЭЦП
  - Где сдаётся отчётность (Контур/СБИС/Астрал)
  - Тип обслуживания (нулевая/минимальная/полное/кадры/…)
- **Финансовая**
  - Оплата в месяц
  - Куда платят
  - Сумма задолженности
- **Контактная**
  - Контактное лицо + телефон + email + Telegram

#### Расширяемость данных (важно уже в MVP)
Требование: “легко добавить новый тип данных” без миграционного ада.

Предлагаемый подход для MVP:
- Базовые поля — как нормальные колонки.
- Расширяемые поля — отдельный механизм `custom_fields` (например, JSONB + конфигурация схемы в админке).
- В UI: блок “Доп. поля” с типами (строка/число/дата/список/флаг), управление доступами к этим полям.

*(Если решите, что кастомные поля появятся только в Этап 2 — можно упростить и оставить только JSONB без UI-конфигуратора, но лучше заложить хотя бы структуру.)*

### 6.4 Документы организации
- Документы: договоры, акты, счета, отчёты (и др. типы).
- Метаданные: тип, дата/период, комментарий, загрузил кто/когда, версия.
- Доступ:
  - сотрудникам, закреплённым за организацией (через участок/ответственных)
  - руководителям-аудиторам участка
  - клиенту этой организации
- Операции: загрузка, скачивание, удаление (по правам), версии (минимум: новая загрузка создаёт новую версию).

### 6.5 Раздел “Полезная информация”
#### Для руководителей и бухгалтеров
1) **Рабочие контакты**
   - поля: Имя / Должность / Телефон / Комментарий
   - создание/редактирование: руководители и бухгалтеры
2) **Материалы (самообучение)**
   - типы: статья/видео/ссылка/файл
   - теги: налоги/бухучёт/клиенты/процессы
   - публикация: руководители и админ
3) **Внутренние документы организации**
   - регламенты, инструкции, договоры, HR-документы
   - доступ: админ + руководители + бухгалтеры

#### Для клиентов
- Материалы для предпринимателей (частично пересекаются).
- Доступ только “клиентскому” разделу материалов.

Доп. идея (опционально, если не раздувает MVP):
- “Частые вопросы” (FAQ) с быстрым поиском.

---

## 7) Безопасность и чувствительные данные
- Пароли пользователей: только хэш (bcrypt/argon2).
- Банковские логины/пароли: хранить как **секреты** (шифрование на уровне поля + ограничение просмотра + аудит).
- Политика доступа к секретам:
  - по умолчанию секреты скрыты
  - просмотр — только по специальному праву, с логированием “кто/когда смотрел”
- Rate limiting + защита от брутфорса.
- Логи и аудит: изменения карточки организации, документы, секреты, права доступа, входы.

*(2FA: запланировано в ROADMAP, но архитектурно не блокируем.)*

---

## 8) Нефункциональные требования
- Производительность: список организаций/участков и карточка должны открываться ≤ 2 сек при 100 организациях на участок.
- Надёжность: резервное копирование БД (ежедневно), восстановление RPO ≤ 24ч.
- Наблюдаемость: централизованные логи ошибок + события аудита.

---

## 9) Технологии и UI
- Frontend: **React 18 + Tailwind CSS**. Допускается временный UI, вы замените своим.
- Design system: `design-system.md` (source of truth).
- Backend/DB: TBD (рекомендуемо: PostgreSQL + объектное хранилище для файлов).

---

## 10) Сущности (минимальная модель данных)
- User, Role, Permission, UserRole
- Section (Участок), SectionMember (user + роль в участке), SectionAuditor
- Organization, OrganizationBankAccount, OrganizationContact, OrganizationServiceInfo
- OrganizationSecrets (или отдельная таблица/хранилище секретов)
- Document, DocumentVersion, DocumentAccessPolicy
- KnowledgeItem (staff/client), KnowledgeTag
- WorkContact
- AuditLog

---

## 11) План релиза
### Этап 1.0 — Скелет
- Авторизация, роли, базовые страницы, каркас сущностей, CI.

### Этап 1.1 — Участки + организации
- CRUD участков, организация, связи user↔section↔org.

### Этап 1.2 — Карточка организации + документы
- Блоки данных, документы с версиями, разграничение доступа.

### Этап 1.3 — Полезная информация + аудит
- Контакты, материалы, внутренние документы, аудит-лог.

---

## 12) Открытые вопросы (нужно решить перед реализацией)
1) Где и как храним секреты (политика ключей, доступов).
2) Хостинг и требования по юрисдикции/соответствию (если есть).
3) Нужна ли клиенту возможность редактировать часть карточки организации в MVP или только смотреть/загружать документы.